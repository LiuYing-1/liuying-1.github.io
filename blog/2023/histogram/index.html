<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="googlece17f0a456a89a36.html"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Histogram | Y. Liu </title> <meta name="author" content="Y. Liu"> <meta name="description" content="Thresholding segmentation and histogram techniques."> <meta name="keywords" content="ku, ucph, copenhagen, diku, portfolio-website, liuying, dk, yingliu, ying liu, liu ying"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?157bbd74cef60250fd5a67a2e078966e"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://liuying-1.github.io/blog/2023/histogram/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Histogram",
            "description": "Thresholding segmentation and histogram techniques.",
            "published": "March 01, 2023",
            "authors": [
              
              {
                "author": "Ying Liu",
                "authorURL": "https://di.ku.dk/Ansatte/forskere/?pure=da/persons/762476",
                "affiliations": [
                  {
                    "name": "DIKU, UCPH",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Y.</span> Liu </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">Ctrl K <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Histogram</h1> <p>Thresholding segmentation and histogram techniques.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#pixel-wise-thresholding">Pixel-wise Thresholding</a> </div> <ul> <li> <a href="#global-thresholding">Global thresholding</a> </li> <li> <a href="#adaptive-thresholding">Adaptive thresholding</a> </li> <li> <a href="#range-thresholding">Range thresholding</a> </li> </ul> <div> <a href="#intensity-histograms">Intensity Histograms</a> </div> <ul> <li> <a href="#definition">Definition</a> </li> <li> <a href="#choosing-thresholds">Choosing thresholds</a> </li> <li> <a href="#intensity-transforms-and-histograms">Intensity transforms and histograms</a> </li> <li> <a href="#a-probabilistic-interpretation">A probabilistic interpretation</a> </li> <li> <a href="#otsu-thresholding">Otsu thresholding</a> </li> </ul> <div> <a href="#histogram-matching">Histogram Matching</a> </div> <ul> <li> <a href="#recall-probability-density-for-continuous-rv">Recall - Probability density for continuous RV</a> </li> <li> <a href="#pdfs-and-functions-of-random-variables-rv">PDFs and functions of random variables (RV)</a> </li> </ul> <div> <a href="#histogram-equilization">Histogram Equilization</a> </div> <ul> <li> <a href="#harsh-reality">Harsh reality</a> </li> <li> <a href="#extensions-of-histogram-equilization">Extensions of Histogram Equilization</a> </li> </ul> </nav> </d-contents> <div align="center"><img src="https://i.imgur.com/BZI3kil.jpeg" alt="1511680791922_.pic" style="zoom:80%;"></div> <div class="reference" style="color: 999; font-size: 0.8em; margin-top: 1em; margin-bottom: 1em;">Reference: Lecture from <a href="https://di.ku.dk/english/staff/vip/researchers_image/?pure=en/persons/83684" _target="blank" rel="external nofollow noopener" target="_blank">Kim Steenstrup Pedersen</a> </div> <h2 id="pixel-wise-thresholding">Pixel-wise Thresholding</h2> <p>In this lecture, we are going to talk about some pixel-wise intensity transformations and we will also be discussing histograms or histograms of intensities and what we can use this for.</p> <h3 id="global-thresholding">Global thresholding</h3> <p>Using some threshold value $\tau$ we can <strong>construct a binary image</strong> from the input</p> \[J(x, y) = \begin{cases} 1, &amp; if \ I(x, y) &gt; \tau \\ 0, &amp; Otherwise \end{cases}\] <p>We can use this for a simple <strong>foreground-background segmentation</strong> or segmentation grouping of pixels in the image.</p> <p>We say that whole bright pixels they now has the value one, they are grouped together. Similar for all dark pixels, all dark pixels they become zero.</p> <div align="center"><img src="https://i.imgur.com/z3NHSe4.png" alt="image-20230301090029439" style="zoom: 25%;"></div> <p>Here we piceked a proper $\tau$ and then apply this transformation to the image and then get this binarized image.</p> <p>However, in the example, some of rice still in the background, that means, the threshold we picked doesn’t seem to actually select the individual rice grain so well.</p> <p>Segmentation algorithm =&gt; Group pixels together according to the threshold.</p> <p>If the scene has a illumination that is varing across the scene, then this simple approach might cause some problem.</p> <p>But we can fix it =&gt; <strong>Adaptive thresholding</strong></p> <h3 id="adaptive-thresholding">Adaptive thresholding</h3> <p>Thresholding transformation is non-linear because if you take the intensity and add some new intensity to it and then perform thresholding you get one result.</p> <div style="font-family: 'Noto Serif SC'">因为如果你把强度加上一些新的强度，然后进行阈值处理，你会得到一个结果。但是如果你把图像在加入一些新的强度之前进行阈值处理，然后对你加入的常数进行阈值处理，那么你得到的结果和你在第一种情况下得到的结果不一样，所以这个是非线性的。</div> <p>Adaptive thresholding: The idea is that we picked a threshold that depended on the local image.</p> <p>Now we start to construct non-linear filter.</p> <p><strong>Let the threshold depend on intensities in a $N\times M$ neighborhood around the target pixel.</strong></p> \[\tau = mean_{N\times M}(I)+C\] <p>$C$ is to make sure that the threshold is high enough, and this $C$ would be the same for all pixels.</p> <div align="center"><img src="https://i.imgur.com/Nn5IdLG.png" alt="image-20230301092513589" style="zoom: 33%;"></div> <p>We choose a specific mean filter size, $15\times15$ pixels, $C=20$, then we get this result.</p> <p>Now we are able to see the rice grains clearly.</p> <p>It’s a non-linear filter because we are operating on a pixels in a non-linear manner. And it is also shifted variant because even though we get different $\tau$ in different location, we are performing the same operation, but the operation now depends on the neighbor pixels.</p> <p><strong><em>But if I try to apply thresholding approch to more complicated image?</em></strong></p> <p>I just converted this to grayscale and then it picked some threshold, and then I get this result.</p> <div align="center"><img src="https://i.imgur.com/MsEzgK1.png" alt="image-20230301101202693" style="zoom: 25%;"></div> <p>Now this is slightly more difficult to use thresholding. You can’t really use this result here.</p> <p>The problem here is that this intensity distribution of this image is no longer bimodal whereas the intensity distribution for the previous example is bimodal which allows us to pick a proper threshold that separates two groups of pixels.</p> <p>This way of performing segmentation only works in certain cases where we have a simple distribution of intensities. =&gt; <strong>This naive form of segmentation only works for simple images (with bimodal intensity distribution)</strong></p> <h3 id="range-thresholding">Range thresholding</h3> <p><strong>Simple color-based segmentation</strong></p> <p>We can also use this approach on a color image.</p> <div align="center"><img src="https://i.imgur.com/5R36F83.png" alt="image-20230301102309064" style="zoom: 25%;"></div> <p><strong>*Step 1 =&gt;</strong> <strong>Convert image from RGB to HSV.*</strong></p> <p>I am interested in segmenting the red picture. I could do this on red channel but it doesn’t work. But if I instead pick a range of Hue value, which represents the color.</p> <p><strong><em>Step 2 =&gt; Choose a range of Hue values $[H</em>{\min}, H<em>{\max}]$ to represent the relevant color (red).</em></strong></p> <p><strong><em>Step 3 =&gt; Set all pixels outside this range to zero and all inside to 1.</em></strong></p> <div style="font-family: 'Noto Serif SC'">例子中显示，我如果对红色通道进行分割，那么无论我怎么选择范围，始终无法覆盖所有红色的水瓶，而且桌子上的橙红色也将被覆盖进去。所以要用 H 通道。</div> <h2 id="intensity-histograms">Intensity Histograms</h2> <h3 id="definition">Definition</h3> <p>To do some statistics on the intensity of an image, we will first define what we mean by an intensity histogram.</p> <p><strong>Intensity histogram</strong>: Count the <strong>number of pixels having specific intensity level</strong> $v\in [0, L-1]$ (assuming $L$ intensity quantization levels).</p> \[H_1(v) = \#\{(x, y), I(x, y) = v \}, v\in[0, L-1]\] <p>Here the range of $v$ is $[0, L-1]$ is for simplicity, in practice, it should be a set of allowable intensity values.</p> <p>Basically, the histogram is just to count the number of pixels here denoted by $(x, y)$. We don’t care about the coordinates but just the number of pixels that have if its intensity value is $v$.</p> <p>We can take an image and then, form the histogram of intensities for all possible intensities. =&gt; Example</p> <div align="center"><img src="https://i.imgur.com/aw75ZYy.png" alt="image-20230301103805324" style="zoom:25%;"></div> <p>In the coins example, we have two peaks. The first peak is most likely the number of the pixels representing the background. The second peak is light gray and this is mostly likely the coins that we observe.</p> <p>There’s better variation in the colors so we have apparently some intensities at most places along the intensity axis.</p> <p><strong><em>Now we recall from the thresholding on the rice grain image and because the rice grain is looks a little bit like the coin when we do the histogram of the rice grain. We also get a bimodal distribution. There are two modes in the distribution.</em></strong></p> <p>But if we look at the more complex example, then we can see that the intensities distribution is much more complicated so it’s hard to find a threshold that separate out the meaningful regions or objects in the image.</p> <p>If we want to find coins, we probably need to choose a threshold somewhere in the middle of the intensity level and then we might do a good job at segmenting the coins.</p> <h3 id="choosing-thresholds">Choosing thresholds</h3> <p>Pick a threshold value $\tau = 126$ and then we’re using this, I can do a segmentation and we can see that we get a pretty good result out of this.</p> <div align="center"><img src="https://i.imgur.com/FIVGrxZ.png" alt="image-20230301110544232" style="zoom:25%;"></div> <p>The distribution of intensities (gray scale) or colors in an image <strong>reveals information about its content</strong>.</p> <p><strong>Bimodal</strong> distribution: Find <strong>an optimal threshold that separates the two peaks</strong>.</p> <p>This gives a good <strong>threshold-based foreground-background segmentation</strong>.</p> <h3 id="intensity-transforms-and-histograms">Intensity transforms and histograms</h3> <p>Let’s just see what happens with the intensity histograms if we apply an intensity transform like the Gamma-correction or exponential and the like.</p> <p>Firstly, we have some image with the <strong>original histogram</strong> for the image.</p> <p>Then, we perform a transformation that <strong>takes all pixels and squares them</strong>. Then we can see that in this shape. Especially, we can see the range of the intensities is $10^4$ whereas the original is from $0$ to $255$. So of course we have stretched the allowed intensity range but it also means that we effectively stretch out the intensity. =&gt; We would see some holes because we have these white lines where the image there were no observations, no pixels that have the value. So when we do this transformation, we are creating such holes.</p> <div align="center"><img src="https://i.imgur.com/eLrW22X.png" alt="image-20230301111726302" style="zoom:25%;"></div> <p>Here is another example with $\log$ transform. It’s very clear that at the lower range of intensities, we now get a lot of holes here. Remember that the $\log$ transformation stretching the low-intensity part and compressing the high-intensity part. =&gt; Just like the image shown below. However, what we also now see that simply because we have a fixed number of discrete quantization levels, we get these holes (white spaces). We don’t have any pixels that have a value in between here. In effect with the quantization level we chose for this image, there will be no pixels that can have this value because that cannot be represented with the quantization level of the original image.</p> <div align="center"><img src="https://i.imgur.com/EsD0rK2.png" alt="image-20230301112320277" style="zoom: 25%;"></div> <p>The last one doesn’t change the actual shape much. It changes the scale of the intensity axis along the x-axis.</p> <h3 id="a-probabilistic-interpretation">A probabilistic interpretation</h3> <p>Model choice: The <strong>intensity at any pixel</strong> in an image is a <strong>random variable</strong>.</p> <p>We can <strong>normalize</strong> the histogram with <strong>respect to the number of pixels</strong> in our image $I$. If $I$ has a spatial resolution of $N\times M$ pixels, then $P_I(v) = \frac{H_1(v)}{NM}$ is the probability that intensity $v$ is found in the image $I$.</p> <div style="font-family: 'Noto Serif SC'">我们可以这样理解。分子是图片在该强度区间的像素数量，而分母是整个图像的分辨率（面积）。</div> <p>$\frac{数量}{面积}=概率$</p> <p>$P_I(v)$ is a <strong>discrete probability mass function (PMF)</strong> (a.k.a. probability mass function $(PDF)$) with $0\leq P_I(v)\leq 1$ and $\sum^{L-1}_{v=0}P_I(v)=1$.</p> <p>The discrete <strong>cumulative distribution function</strong> <strong>(CDF)</strong> is</p> \[F_I(x) = P_I(v\leq x) = \sum_{v\leq x}P_I(v)\] <h3 id="otsu-thresholding">Otsu thresholding</h3> <p><strong><em>How to select an optimal threshold?</em></strong></p> <p>Consider a histogram with two modes as being separated in two class, then find the optimal threshold $k^*$ by maximizing the between-class variance</p> \[\sigma^2_B = \omega_0(\mu_0 - \mu_T)^2 + \omega_1(\mu_1 - \,u_T)^2 = \omega_0\omega_1(\mu_1 - \mu_0)^2\] <div align="center"><img src="https://i.imgur.com/lhemP8U.png" alt="image-20230301114322459" style="zoom:25%;"></div> \[\begin{align} k^* &amp;= \arg\max_{0\leq k\leq L-1 }\sigma_B^2(k)\\ \mu_T &amp;= \mu(L-1) \Leftarrow Total\ Mean\\ \mu(k) &amp;= \sum_{i=0}^k ip(i) \Leftarrow Mean\ of\ Class\ 0\\ \omega(k) &amp;= \sum^k_{i=0}p(i)\Leftarrow CDF\\ \sigma^2_B(k) &amp;= \frac{[\mu_T\omega(k)-\mu(k)]^2}{\omega(k)[1-\omega(k)]} \end{align}\] <div align="center"><img src="https://i.imgur.com/dfCrHt5.png" alt="image-20230301115425886" style="zoom:25%;"></div> <h2 id="histogram-matching">Histogram Matching</h2> <p><strong>Histogram matching between the histograms of two images</strong></p> <p>We consider intensities in an image as a random variable (RV). The normalized histogram gives the distribution of these intensities.</p> <p>In the following, we will consider limiting case of an image with a continuous range of intensities. That is, we have a continuous probability density function (PDF) over intensities.</p> <div style="font-family: 'Noto Serif SC'">我们可以先从连续型概率密度函数 PDF 入手，再考虑离散型。</div> <p><strong>Question:</strong> Given two intensity probability transforms, can we derive an intensity transformation when applied to one image transforms the CDF (or PDF) to match the CDF (or PDF) of the other image? =&gt; If an intensity transformation is applied to the image, can one derive the new intensity probability function? =&gt; If an intensity transformation is applied to an image, can one derive the new intensity probability function. <strong><u>Or, if we have an image with specific PDF, we apply some transformation to the intensities, can we figure out what is the probability density function for this new transformed image?</u></strong> =&gt; <strong>YES</strong></p> <h3 id="recall---probability-density-for-continuous-rv">Recall - Probability density for continuous RV</h3> <div align="center"><img src="https://i.imgur.com/8RBxhDw.png" alt="image-20230301122603178" style="zoom: 25%;"></div> <h3 id="pdfs-and-functions-of-random-variables-rv">PDFs and functions of random variables (RV)</h3> <p>Let $R$ be a real RV and $g: \R \mapsto \R$ (or $[a, b] \mapsto [c, d]$) a function that maps $R$ to the RV $S = g(R)$.</p> <div style="font-family: 'Noto Serif SC'">假设我们有一个随机变量 $X$，还有一个用于对 $X$ 做强度变换的方程 $g$。</div> <p>In the following, I will <strong><u>use $r$ to denote intensities in the original image</u></strong> and <strong><u>$s$ to denote intensities in the transformed image</u></strong>.</p> <p><strong><em>Can we compute the CDF $F_S$ from $F_R$?</em></strong></p> <p><strong><em>Step 1</em></strong>. Start from the CDF of $S$</p> \[F_S(s) = \int^s_{-\infty}p_S(x')dx' = P(S\leq s) = P(S\in (-\infty, s])\] <p><strong><em>Step 2</em></strong>. Since $S = g(R)$, we have</p> \[S\in (-\infty, s] \Leftrightarrow g(R) \in (-\infty, s) \Leftrightarrow R\in g^{-1}((-\infty, s])\] <p><strong><em>Step 3</em></strong>. So we can write</p> \[F_S(s) = P(S\in (-\infty, S]) = P(R\in g^{-1}((-\infty, s]))\] <p><strong><em>Hence, we need to focus and compute $g^{-1}((-\infty, s])$!</em></strong></p> <p>The simplest case is to <strong>assume that $g$ has an inverse</strong>, which implies that it is strictly monotonic (either increasing or decreasing).</p> <p>Simplest simple case: $g$ is <strong>strictly increasing</strong>, then</p> \[g^{-1}\left((-\infty, s]\right) = (-\infty, g^{-1}(s)]\] <p>Thus, the relation between the CDFs are</p> \[F_S(s) = P(R \in (-\infty, g^{-1}(s)]) = F_R(g^{-1}(s))\] <p>Lets set $r = g^{-1}(s) \Leftrightarrow s = g(r)$, and then, we get</p> \[F_S(s) = F_R(g^{-1}(s)) \Leftrightarrow F_S(g(r)) = F_R(r)\] <p>If $F_S$ is strictly increasing then we can retrieve $g$ by</p> \[g(r) = F_S^{-1}(F_R(r))\] <p><strong><em>Explanation</em></strong></p> <p>Let’s consider this scenario that we have an input image.</p> <p>It has a histogram from the histogram, we can compute the CDF of this image. $F_R$.</p> <div align="center"><img src="https://i.imgur.com/LxgkMOI.png" alt="image-20230301132151016" style="zoom:25%;"></div> <p>The formula tells us that if I pick any pixel in my image and if I figure out what I look up what is the intensity value at that pixel. Let’s assume that it’s $r$.</p> <p>First, we need to look up what is the value of the CDF of the original image of $r$ =&gt; $F_R(r)$.</p> <p>Then, we need to do an inverse look up in the CDF $F_S$ of the result image that we want.=&gt; Gives me the new intensity value that I should write into the output image. And this value is computing by $g(r) = F_S^{-1}\left(F_R(r)\right)$</p> <p><strong><em>The consequence is that we can change from the distribution given by CDF $F_R$ to one with CDF $F_S$.</em></strong></p> <div style="font-family: 'Noto Serif SC'">所以，只要我们有了输入图像的 CDF 和想要的输出图像的 CDF，那么我们就可以将强度变换后的图像输出。</div> <p>We can use this to match intensity histograms of two images. =&gt; <strong>Histogram Matching</strong></p> <p><strong>Application</strong></p> <p>We can take one image as the input, and compute its CDF. Then, we can take another image which has a distribution that we would like, and then, we compute the CDF of that. Then, we can take the original image and apply the strategy. Construct a version of the image that has the same probability CDF as the latter image.</p> <h2 id="histogram-equilization">Histogram Equilization</h2> <p><strong>Contrast stretching</strong></p> <div align="center"><img src="https://i.imgur.com/zu39Wvp.png" alt="image-20230301133522502" style="zoom:25%;"></div> <p>We can see there’s a lot of pixels in the dark range of the intensity range. Now, the question is can we do something to improve the contrast in this image to stretch the dynamic range of the image so that we can easily see more details in the tire region.</p> <p>One way to view this is that we would like to make a mapping of this intensity distribution and wrap it towards a probability distribution that is uniform and so that all the intensities are equally.</p> <p>If we do this, then we sort of redistribute the inside the individual pixel so that they take up ore use the complete range of available intensities for our quantization.</p> <p>We are looking for remapping to a new PDF with $p_S(s) = \frac{1}{L}$. =&gt; Uniform distribution $p_S: [0, L] \to \R$</p> <p><strong><em>How to find a mapping $g$ such that $S = g(R)$ has a flat PDF?</em></strong></p> <p>I will go about deriving histogram equalization in a slightly different way than for histogram matching. But it will turn out that we are <strong><em>actually performing histogram matching</em></strong>.</p> <p><strong><em>Question</em></strong>. We have $p_S(s) = \frac{1}{L}$ and $p_R(r)$, and want to find $g(r)$.</p> <p>I pull a matehmatical white rabbit and write up this differential equation (we use this notation $g’(r) = dg/dr$)</p> \[g'(r) = \frac{p_R(r)}{p_S(g(r))}\] <p>The expression above is because =&gt; we know that $F_S(g(r)) = F_R(r)$. Lets compute derivative with respect to $r$ on both sides:</p> <div align="center"><img src="https://i.imgur.com/98hGtl3.png" alt="image-20230301142954653" style="zoom:25%;"></div> <div style="font-family: 'Noto Serif SC'">用了莱布尼兹和链式法则得到了这个“白兔”。</div> <p>And since $p_S(s) = 1/L$, we have $g’(r)=L_{p_R}(r).$</p> <p>Solve this differential equation by integration</p> \[g(r) = \int^r_0 g'(\rho)d\rho = L\int^r_0p_R(\rho)d\rho = LF_R(r)\] <p>Actually, we have just shown that histogram equalization is histogram matching of CDF $F_R(r)$ to CDF $F_S(s) = s/L$ (i.e. the CDF of the uniform distribution $p_S(s) = 1/L$).</p> <div align="center"><img src="https://i.imgur.com/CQFjl5R.png" alt="image-20230301143626209" style="zoom:25%;"></div> <h3 id="harsh-reality">Harsh reality</h3> <p>Perfect histogram equalization is in general not possible due to quantization, missing intensity ranges. =&gt;</p> <div style="font-family: 'Noto Serif SC'">从图上就可以看出来我们无法得到绝美的结果，因为始终会有 HOLES 由于之间的空白导致。</div> <p>In practice, not all CDF’s are strictly increasing! It is possible to have constant plateau’s, if a range of intensities are not occurring in the image.</p> <h3 id="extensions-of-histogram-equilization">Extensions of Histogram Equilization</h3> <h4 id="intensity-hisogram-equalization-of-color-images">Intensity hisogram equalization of color images</h4> <p><strong><em>How do we perform histogram equalization of color images?</em></strong></p> <p><strong><em>Step 1</em></strong>. Convert RGB image to HSV.</p> <p><strong><em>Step 2</em></strong>. Perform histogram equalization on V channel. V channel is the intensity of the pixel values. Have nothing to do with color.</p> <p><strong><em>Step 3</em></strong>. Convert processed image from HSV back to RGB</p> <div align="center"><img src="https://i.imgur.com/wzKc9es.png" alt="image-20230301145457653" style="zoom:25%;"></div> <p>We can see that histogram equalization doesn’t do anything good to this region of a bright pixels, it looks a little bit worse than in the original image. But it definitely brightens up the dark part. But we can handle this problem with a variant. =&gt; <strong>Adaptive Histogram Equalization / Matching</strong></p> <h4 id="adaptive-histogram-equalization">Adaptive histogram equalization</h4> <p><strong>A non-linear filter</strong></p> <div align="center"><img src="https://i.imgur.com/qcY8x1T.png" alt="image-20230301145934595" style="zoom: 33%;"></div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Y. Liu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-JC70RZ57BT"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JC70RZ57BT");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-cv",title:"CV",description:"Here is a brief overview of my academic and professional background, and hope there is something interesting for you. The more comprehensive version can be accessed by clicking the PDF icon on right top corner of this page.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"post-line-segment-intersection",title:"Line Segment Intersection",description:"Self-learning note for CG - Line Segment Intersection.",section:"Posts",handler:()=>{window.location.href="/blog/2024/line-segment-intersection/"}},{id:"post-graduation",title:"Graduation",description:"Congratulations to my graduation from the DIKU, University of Copenhagen.",section:"Posts",handler:()=>{window.location.href="/blog/2024/graduation/"}},{id:"post-review-of-swav",title:"Review of SwAV",description:"This is the learning of the paper SwAV.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/swav.pdf"}},{id:"post-review-of-simsiam",title:"Review of SimSiam",description:"This is the learning of the paper SimSiam.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/SimSIAM.pdf"}},{id:"post-extracts-from-byol",title:"Extracts from BYOL",description:"Review of the paper BYOL and to extract the main points",section:"Posts",handler:()=>{window.location.href="/blog/2024/byol/"}},{id:"post-cookbook-reading-1",title:"Cookbook Reading - 1",description:"This is the first part of this book.",section:"Posts",handler:()=>{window.location.href="/blog/2024/cookbook-1/"}},{id:"post-advanced-image-registration",title:"Advanced Image Registration",description:"Self-learning note for advanced image registration.",section:"Posts",handler:()=>{window.location.href="/blog/2023/advanced-image-registration/"}},{id:"post-image-registration-basics",title:"Image Registration Basics",description:"Learning note for medical image registration.",section:"Posts",handler:()=>{window.location.href="/blog/2023/image-registration-l1/"}},{id:"post-segmentation-basics",title:"Segmentation Basics",description:"Learning note for medical image segmentation.",section:"Posts",handler:()=>{window.location.href="/blog/2023/segmentation-basics/"}},{id:"post-inpainting",title:"Inpainting",description:"Learning note for inpainting.",section:"Posts",handler:()=>{window.location.href="/blog/2023/inpainting/"}},{id:"post-magnetic-resonance",title:"Magnetic Resonance",description:"Preview of the lecture for MRI.",section:"Posts",handler:()=>{window.location.href="/blog/2023/mia-mr/"}},{id:"post-x-ray-and-ct",title:"X-ray and CT",description:"This is the first lecture of the course Medical Image Analysis at UCPH.",section:"Posts",handler:()=>{window.location.href="/blog/2023/mia-l1/"}},{id:"post-dansk-gt-0307",title:"Dansk &gt; 0307",description:"This is the learning note for my first lesson at Ucplus.",section:"Posts",handler:()=>{window.location.href="/blog/2023/dansk-week-1/"}},{id:"post-dictation-gt-the-art-of-balancing-stones",title:"Dictation &gt; The Art of Balancing Stones",description:"This is a daily dictation 2 for English improvement.",section:"Posts",handler:()=>{window.location.href="/blog/2023/the-art-of-balancing-stones/"}},{id:"post-dictation-gt-the-egg",title:"Dictation &gt; The Egg",description:"This is a daily dictation 1 for English improvement.",section:"Posts",handler:()=>{window.location.href="/blog/2023/the-egg/"}},{id:"post-neural-network-ii-mlops",title:"Neural Network II | MLOps",description:"This is the lecture for Neural Network II and MLOps.",section:"Posts",handler:()=>{window.location.href="/blog/2023/ml-ops/"}},{id:"post-neural-network",title:"Neural Network",description:"Recap of Neural Network",section:"Posts",handler:()=>{window.location.href="/blog/2023/neural-network-recap/"}},{id:"post-easter-lunch",title:"Easter Lunch",description:"This is the first time to have lunch with my Danish family at Easter.",section:"Posts",handler:()=>{window.location.href="/blog/2023/easter-lunch/"}},{id:"post-segmentation",title:"Segmentation",description:"Image Segmentation, including Hough Transform",section:"Posts",handler:()=>{window.location.href="/blog/2023/segmentation/"}},{id:"post-features",title:"Features",description:"Image feature detection and matching with application.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/features.pdf"}},{id:"post-transformation",title:"Transformation",description:"Affine, Rigid, Perspective linear transformations, etc.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/geometry.pdf"}},{id:"post-deconvolution",title:"Deconvolution",description:"Image Restoration by Deconvolution",section:"Posts",handler:()=>{window.location.href="/blog/2023/deconvolution/"}},{id:"post-histogram",title:"Histogram",description:"Thresholding segmentation and histogram techniques.",section:"Posts",handler:()=>{window.location.href="/blog/2023/histogram/"}},{id:"post-fourier",title:"Fourier",description:"Complex numbers and Fourier transformation.",section:"Posts",handler:()=>{window.location.href="/blog/2023/fourier/"}},{id:"post-filtering",title:"Filtering",description:"Linear and non-linear filtering, derivative operators.",section:"Posts",handler:()=>{window.location.href="/blog/2023/filtering/"}},{id:"post-convolution",title:"Convolution",description:"Pixel-wise Operations, Intensity, Transformations, Image Formation, and the Convolution Integral.",section:"Posts",handler:()=>{window.location.href="/blog/2023/convolution/"}},{id:"post-app-and-term",title:"App and Term",description:"Introduction of the Signal and Image Processing course, including the basic concepts, terminology, and applications.",section:"Posts",handler:()=>{window.location.href="/blog/2023/intro/"}},{id:"post-aads-grade",title:"AADS Grade",description:"This is to record I got 12 on the course Advanced Algorithms and Data Structures.",section:"Posts",handler:()=>{window.location.href="/blog/2023/aads-grade/"}},{id:"post-polygon-triangulation",title:"Polygon Triangulation",description:"This is the learning note for Polygon Triangulation.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/polygon.pdf"}},{id:"post-approximation",title:"Approximation",description:"This is the learning note for Approximation algorithm - 1.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/approx1.pdf"}},{id:"post-exact-parameterized",title:"Exact-Parameterized",description:"This is the learning note for Exact-Parameterized algorithm.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/EE.pdf"}},{id:"post-npc",title:"NPC",description:"This is the learning note for NPC.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/NPC.pdf"}},{id:"post-van-emde-boas-tree",title:"van Emde Boas Tree",description:"This is the learning note for vEB.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/van-Emde-Boas-Trees.pdf"}},{id:"post-sad-mood",title:"Sad Mood",description:"This blog is to record my current sad mood.",section:"Posts",handler:()=>{window.location.href="/blog/2023/sad-mood/"}},{id:"post-hashing",title:"Hashing",description:"This is the learning note for Hashing.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/Hashing.pdf"}},{id:"post-randomized-algorithms",title:"Randomized Algorithms",description:"This is the learning note for the Randomized Algorithms.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/RA.pdf"}},{id:"post-linear-programming",title:"Linear Programming",description:"This is the learning note for the Linear Programming.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/Linear-programming.pdf"}},{id:"post-max-flow",title:"Max-flow",description:"This is the learning note for the Max-flow.",section:"Posts",handler:()=>{window.location.href="/assets/pdf/Max-flow.pdf"}},{id:"post-recovery-gt-crash",title:"Recovery &gt; Crash",description:"This is the special case of the recovery when the system crashes.",section:"Posts",handler:()=>{window.location.href="/blog/2023/recovery-crash/"}},{id:"post-recovery-gt-normal",title:"Recovery &gt; Normal",description:"This is the special part for recovery and normal.",section:"Posts",handler:()=>{window.location.href="/blog/2023/recovery-normal/"}},{id:"post-experiment-recovery",title:"Experiment | Recovery",description:"Here are the chapters of Experiments and Recovery.",section:"Posts",handler:()=>{window.location.href="/blog/2023/recover/"}},{id:"post-concourrency-2",title:"Concourrency 2",description:"This is the chapter relating to concurrency control - Part 2.",section:"Posts",handler:()=>{window.location.href="/blog/2023/concurrency-2/"}},{id:"post-concourrency-1",title:"Concourrency 1",description:"This is the chapter relating to concurrency control.",section:"Posts",handler:()=>{window.location.href="/blog/2022/concurrency/"}},{id:"post-godt-nyt\xe5r",title:"Godt Nyt\xe5r",description:"The blog is to record my first New Year&#39;s Eve in Denmark!",section:"Posts",handler:()=>{window.location.href="/blog/2022/godt-nytar/"}},{id:"post-incorrect-url",title:"Incorrect URL",description:"Last time, my neighbor, whose world ranking in CSGO is the Global Elite, received a Christmas gift by his nisse.",section:"Posts",handler:()=>{window.location.href="/blog/2022/incorrect-url/"}},{id:"post-rpc-performance",title:"RPC | Performance",description:"RPC and Permance are the two topics we will cover today.",section:"Posts",handler:()=>{window.location.href="/blog/2022/rpc/"}},{id:"post-abstractions",title:"Abstractions",description:"Basic concepts of computer systems.",section:"Posts",handler:()=>{window.location.href="/blog/2022/abstractions/"}},{id:"post-tivoli-firework",title:"Tivoli Firework",description:"To accompany Jianxiang Yu, we went to the second oldest theme park worldwide, Tivoli in Denmark yesterday.",section:"Posts",handler:()=>{window.location.href="/blog/2022/tivoli-firework/"}},{id:"post-royal-guardian",title:"Royal Guardian",description:"The shift of the royal guardian in Marmorkirken.",section:"Posts",handler:()=>{window.location.href="/blog/2022/royal-gardian/"}},{id:"post-swan-nearby",title:"Swan Nearby",description:"A record to keep this swan in my memory.",section:"Posts",handler:()=>{window.location.href="/blog/2022/swan-nearby/"}},{id:"post-chef-first-time",title:"Chef First Time",description:"This is my first time being the chef to cook for my danish family!",section:"Posts",handler:()=>{window.location.href="/blog/2022/chief-first-time/"}},{id:"post-travel-to-malm\xf6",title:"Travel to Malm\xf6",description:"This is the final version of the image preprocessing with the limitation that cannot automatically crop the image in the center. However, it can work properly in normal situations. Also, this blog is used to record my trip to Malm\xf6, Sweden with Xuanlang.",section:"Posts",handler:()=>{window.location.href="/blog/2022/travel-to-malmo/"}},{id:"post-dev-progress",title:"Dev Progress",description:"In this version, the development of my blog website is already passed half. \u8fd9\u91cc\u662f\u4e2d\u6587\u5b57\u4f53\u6d4b\u8bd5\u3002",section:"Posts",handler:()=>{window.location.href="/blog/2022/dev-progress/"}},{id:"post-take-metro",title:"Take Metro",description:"This blog is to record my route from DIKU back to my dorm at 00:53 am several days ago.",section:"Posts",handler:()=>{window.location.href="/blog/2022/take-metro/"}},{id:"post-start-my-blog",title:"Start My Blog",description:"Memorize the start of the implementation of my blog-web.",section:"Posts",handler:()=>{window.location.href="/blog/2022/start-my-blog/"}},{id:"news-i-have-defended-my-master-thesis-quot-exploration-of-self-supervised-learning-methods-for-longitudinal-image-analysis-quot-and-received-my-master-39-s-degree-meanwhile-i-have-been-offered-a-job-as-an-ai-engineer-in-component-ai-aps",title:"I have defended my master thesis **&quot;Exploration of Self-Supervised Learning Methods for Longitudinal Image Analysis&quot;** and received my Master&#39;s Degree. Meanwhile, I have been offered a job as an **AI Engineer** in Component-AI ApS. \ud83c\udf93\ud83c\udf89\ud83d\ude80",description:"",section:"News"},{id:"news-going-to-be-one-of-tas-for-the-course-advanced-deep-learning-in-b4-2024-at-university-of-copenhagen",title:"\ud83e\udd70 Going to be one of TAs for the course **Advanced Deep Learning** in B4-2024 at University of Copenhagen.",description:"",section:"News"},{id:"news-congrats-to-me-for-passing-the-courses-medical-image-analysis-advanced-topics-in-image-analysis-and-project-of-research-in-self-supervised-learning-methods-for-longitudinal-images-with-10-out-of-12",title:"\ud83e\udd73 Congrats to me for passing the courses **Medical Image Analysis**, **Advanced Topics in Image Analysis**, and **Project of Research in Self-Supervised Learning Methods for Longitudinal Images** with **10 out of 12**.",description:"",section:"News"},{id:"news-i-am-happy-to-share-i-got-12-out-of-12-in-the-courses-of-advanced-algorithms-and-data-structures-signal-and-image-processing-and-advanced-deep-learning",title:"\ud83c\udf7b I am happy to share I got **12 out of 12** in the courses of **Advanced Algorithms and Data Structures**, **Signal and Image Processing**, and **Advanced Deep Learning**.",description:"",section:"News"},{id:"news-learning-notes-advanced-algorithms-and-data-structures-https-liuying-1-github-io-blog-tag-aads-signal-and-image-processing-https-liuying-1-github-io-blog-tag-sip-and-advanced-computer-systems-https-liuying-1-github-io-blog-tag-acs-have-been-transferred-from-my-self-developed-website-to-this-one",title:"\ud83d\udcd4 Learning notes [**Advanced Algorithms and Data Structures**](https://liuying-1.github.io/blog/tag/aads), [**Signal and Image Processing**](https://liuying-1.github.io/blog/tag/sip), and [**Advanced Computer Systems**](https://liuying-1.github.io/blog/tag/acs) have been transferred from my self-developed website to this one.",description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%6C%79%35%38%31%30%39%39@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/liu-ying-463ab925b","_blank")}},{id:"socials-facebook",title:"Facebook",section:"Socials",handler:()=>{window.open("https://facebook.com/100085288350390","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>